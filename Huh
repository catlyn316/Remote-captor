--[[  RemoteSpy v5  |  Delta iOS å¹³æ¿ç‰ˆ  ]]
--  ä¿®æ­£ï¼šæ‹–æ‹½æ”¹ç”¨ UIS å…¨å±€ Touch äº‹ä»¶ï¼ˆDelta ç›¸å®¹ï¼‰
--        ä»‹é¢ä½ˆå±€é‡æ–°è¨ˆç®—ï¼Œç§»é™¤ ClipsDescendants
--        ä¿®æ­£ç¸®å°å¾Œé»žæ“Šèª¤è§¸å•é¡Œï¼ˆåªæœ‰é»žå°æ–¹å¡Šæ‰å±•é–‹ï¼‰
--        ä¿®æ­£ç¸®å°å¾Œ TF è¶…å‡ºåœ“è§’ï¼ˆå‹•æ…‹åœ“è§’åˆ‡æ›ï¼‰
--        æ–°å¢žç„¡äº‹ä»¶æç¤º

local UIS = game:GetService("UserInputService")
local PL  = game:GetService("Players").LocalPlayer
local RS  = game:GetService("RunService")

-- â”€â”€ è³‡æ–™ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
local captured = {}
local selId    = nil
local loops    = {}; local loopN = 0
local fRE, fRF = true, true

-- â˜… äº‹ä»¶ä½‡åˆ—ï¼šhook åŸ·è¡Œç·’ â†’ ä¸»åŸ·è¡Œç·’
local pendingQueue = {}

-- â”€â”€ å·¥å…· â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
local function getPath(o)
    if not o or not o.Parent then return "nil" end
    local t,c={},o
    while c and c~=game do table.insert(t,1,c.Name);c=c.Parent end
    local s='game:GetService("'..(t[1] or "?")..'")'
    for i=2,#t do
        s=s..(t[i]:match("^[%a_][%w_]*$") and "."..t[i] or '["'..t[i]:gsub('"','\\"')..'"]')
    end
    return s
end

local function ser(v,d)
    d=d or 0; if d>3 then return "..." end
    local t=typeof(v)
    if     t=="nil"      then return "nil"
    elseif t=="boolean"  then return tostring(v)
    elseif t=="number"   then return tostring(v)
    elseif t=="string"   then return ("%q"):format(v)
    elseif t=="Instance" then return getPath(v)
    elseif t=="Vector3"  then return ("Vector3.new(%g,%g,%g)"):format(v.X,v.Y,v.Z)
    elseif t=="Vector2"  then return ("Vector2.new(%g,%g)"):format(v.X,v.Y)
    elseif t=="CFrame"   then local p=v.Position return("CFrame.new(%g,%g,%g)"):format(p.X,p.Y,p.Z)
    elseif t=="Color3"   then return("Color3.fromRGB(%d,%d,%d)"):format(v.R*255,v.G*255,v.B*255)
    elseif t=="EnumItem" then return tostring(v)
    elseif t=="table"    then
        local s={}
        for k,val in pairs(v) do
            local ks=type(k)=="string" and(k:match("^[%a_][%w_]*$") and k or'["'..k..'"]')or"["..tostring(k).."]"
            table.insert(s,ks.."="..ser(val,d+1))
        end
        return "{"..table.concat(s,",").."}"
    else return"nil--[["..t.."]]" end
end

local function mkCode(e)
    local a={}; for _,v in ipairs(e.args) do table.insert(a,ser(v)) end
    return e.path..":"..(e.rtype=="RemoteEvent" and "FireServer" or "InvokeServer").."("..table.concat(a,", ")..")"
end

local function clip(s)
    if setclipboard    then setclipboard(s)
    elseif toclipboard then toclipboard(s)
    elseif Clipboard   then Clipboard.set(s) end
end

local function exec(code)
    local ok,err=pcall(function() assert(loadstring(code))() end)
    return ok,err
end

-- â”€â”€ HOOK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
local _nc
_nc=hookmetamethod(game,"__namecall",newcclosure(function(self,...)
    local m=getnamecallmethod()
    if m=="FireServer" or m=="InvokeServer" then
        local ok,cls=pcall(function() return self.ClassName end)
        if ok and(cls=="RemoteEvent" or cls=="RemoteFunction") then
            local ok2,path=pcall(getPath,self)
            if ok2 then
                local e={id=#captured+1,remote=self,rtype=cls,
                    name=self.Name,path=path,args={...},method=m,ts=os.date("%H:%M:%S")}
                e.code=mkCode(e)
                table.insert(captured,e)
                if _G._RSP5 then pcall(_G._RSP5,e) end
            end
        end
    end
    return _nc(self,...)
end))

-- â”€â”€ æ¸…ç†èˆŠ GUI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
for _,n in ipairs({"RSP5","RSP4","RSP3","RSPv2","RemoteSpyPro"}) do
    pcall(function() game:GetService("CoreGui")[n]:Destroy() end)
    pcall(function() PL.PlayerGui[n]:Destroy() end)
end

local SG=Instance.new("ScreenGui")
SG.Name="RSP5"; SG.ResetOnSpawn=false
SG.ZIndexBehavior=Enum.ZIndexBehavior.Sibling
if not pcall(function() SG.Parent=game:GetService("CoreGui") end) then
    SG.Parent=PL.PlayerGui
end

-- â”€â”€ è‰²ç›¤ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
local K={
    bg =Color3.fromRGB(12,13,19),  pnl=Color3.fromRGB(18,20,29),
    p2 =Color3.fromRGB(23,26,40),  bdr=Color3.fromRGB(40,46,70),
    acc=Color3.fromRGB(82,138,255),grn=Color3.fromRGB(55,200,112),
    red=Color3.fromRGB(255,68,68), yel=Color3.fromRGB(252,188,48),
    txt=Color3.fromRGB(212,218,235),dim=Color3.fromRGB(100,110,145),
    cod=Color3.fromRGB(145,215,145),sel=Color3.fromRGB(30,52,100),
    hov=Color3.fromRGB(26,30,50),  RE =Color3.fromRGB(52,172,255),
    RF =Color3.fromRGB(195,85,255),
}

local function N(cls,p,par)
    local o=Instance.new(cls)
    for k,v in pairs(p) do o[k]=v end
    if par then o.Parent=par end
    return o
end
local F  =function(p,par) return N("Frame",p,par) end
local L  =function(p,par) return N("TextLabel",p,par) end
local B  =function(p,par) return N("TextButton",p,par) end
local TB =function(p,par) return N("TextBox",p,par) end
local SF =function(p,par) return N("ScrollingFrame",p,par) end
local function rnd(r,o) N("UICorner",{CornerRadius=UDim.new(0,r)},o) end
local function stk(c,t,o) N("UIStroke",{Color=c,Thickness=t},o) end
local function lst(sp,o)
    N("UIListLayout",{FillDirection=Enum.FillDirection.Vertical,
        HorizontalAlignment=Enum.HorizontalAlignment.Left,
        Padding=UDim.new(0,sp),SortOrder=Enum.SortOrder.LayoutOrder},o)
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  ä¸»è¦–çª—  420 Ã— 350
--  ä½ˆå±€ï¼ˆçµ•å° Yï¼‰ï¼š
--    Y=0   é ‚è‰²æ¢  H=2
--    Y=2   æ¨™é¡Œåˆ—  H=28  â†’ åº• 30
--    Y=32  æœå°‹åˆ—  H=24  â†’ åº• 56
--    Y=60  ä¸»é«”    H=180 â†’ åº• 240
--    Y=244 è‡ªè¨‚å€  H=94  â†’ åº• 338
--    Y=340 ç‹€æ…‹åˆ—  H=10
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local WIN=F({Name="WIN",
    Size=UDim2.new(0,420,0,352),
    Position=UDim2.new(0,60,0,60),
    BackgroundColor3=K.bg,
    BorderSizePixel=0,
    ClipsDescendants=false},SG)
rnd(8,WIN); stk(K.bdr,1.5,WIN)

-- é ‚è‰²æ¢
local tc=F({Size=UDim2.new(1,0,0,2),Position=UDim2.new(0,0,0,0),
    BackgroundColor3=K.acc,BorderSizePixel=0},WIN)
N("UIGradient",{Color=ColorSequence.new{
    ColorSequenceKeypoint.new(0,Color3.fromRGB(110,72,255)),
    ColorSequenceKeypoint.new(.5,K.acc),
    ColorSequenceKeypoint.new(1,K.grn),
}},tc)

-- â”€â”€ æ¨™é¡Œåˆ— Y=2 H=28 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
local TF=F({Size=UDim2.new(1,0,0,28),Position=UDim2.new(0,0,0,2),
    BackgroundColor3=K.pnl,BorderSizePixel=0},WIN)
local TF_CORNER=N("UICorner",{CornerRadius=UDim.new(0,0)},TF)  -- â˜… å‹•æ…‹åœ“è§’

-- ä¸»æ¨™é¡Œï¼ˆç¸®å°æ™‚éš±è—ï¼‰
local TITLELBL=L({Text="â—ˆ äº‹ä»¶ç²å–å™¨",Size=UDim2.new(0,110,0,16),Position=UDim2.new(0,8,0,2),
    BackgroundTransparency=1,TextColor3=K.txt,Font=Enum.Font.GothamBold,
    TextSize=11,TextXAlignment=Enum.TextXAlignment.Left},TF)
-- å‰¯æ¨™ï¼ˆç¸®å°æ™‚éš±è—ï¼‰
local BYLBL=L({Text="by è²“çŽ²",Size=UDim2.new(0,60,0,11),Position=UDim2.new(0,10,0,17),
    BackgroundTransparency=1,TextColor3=K.acc,Font=Enum.Font.Gotham,
    TextSize=7,TextXAlignment=Enum.TextXAlignment.Left},TF)

local CNTL=L({Text="0",Size=UDim2.new(0,70,1,0),Position=UDim2.new(0,112,0,0),
    BackgroundTransparency=1,TextColor3=K.dim,Font=Enum.Font.Gotham,
    TextSize=9,TextXAlignment=Enum.TextXAlignment.Left},TF)

local function tB(txt,col,xOff)
    local b=B({Text=txt,Size=UDim2.new(0,24,0,20),
        Position=UDim2.new(1,xOff,0,4),
        BackgroundColor3=K.p2,TextColor3=col,
        Font=Enum.Font.GothamBold,TextSize=11,
        BorderSizePixel=0,ZIndex=10},TF)
    rnd(4,b); return b
end
local BCLOSE=tB("x",  K.red, -28)
local BMIN  =tB("-",  K.yel, -56)
local BCLR=B({Text="æ¸…",Size=UDim2.new(0,24,0,20),
    Position=UDim2.new(1,-84,0,4),
    BackgroundColor3=K.p2,TextColor3=K.dim,
    Font=Enum.Font.Gotham,TextSize=10,
    BorderSizePixel=0,ZIndex=10},TF)
rnd(4,BCLR); stk(K.bdr,1,BCLR)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  â˜…â˜…â˜… æ‹–æ‹½ï¼šDelta/iOS ç›¸å®¹ç‰ˆ â˜…â˜…â˜…
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local dragging   = false
local dragTouch  = nil
local dragOff    = Vector2.new(0,0)
local mini       = false

-- åˆ¤æ–·çµ•å°åº§æ¨™æ˜¯å¦åœ¨æ¨™é¡Œåˆ—çš„å¯æ‹–å‹•å€
local function inTitleBar(ax, ay)
    local wp = WIN.AbsolutePosition
    local ws = WIN.AbsoluteSize
    if mini then
        return ax >= wp.X and ax <= wp.X + ws.X
           and ay >= wp.Y and ay <= wp.Y + ws.Y
    else
        local tfH = 30
        return ax >= wp.X
           and ax <= wp.X + ws.X - 92
           and ay >= wp.Y
           and ay <= wp.Y + tfH
    end
end

-- â˜… å…¨å±€ TouchStarted
UIS.TouchStarted:Connect(function(touch, _)
    if dragTouch then return end
    local ax = touch.Position.X
    local ay = touch.Position.Y
    if inTitleBar(ax, ay) then
        dragTouch = touch
        dragging  = true
        dragOff   = Vector2.new(ax, ay) - WIN.AbsolutePosition
    end
end)

-- â˜… å…¨å±€ TouchMoved
UIS.TouchMoved:Connect(function(touch, _)
    if not dragging or touch ~= dragTouch then return end
    local ax = touch.Position.X
    local ay = touch.Position.Y
    WIN.Position = UDim2.new(0, ax - dragOff.X, 0, ay - dragOff.Y)
end)

-- â˜… å…¨å±€ TouchEnded
UIS.TouchEnded:Connect(function(touch, _)
    if touch == dragTouch then
        dragging  = false
        dragTouch = nil
    end
end)

-- PC æ»‘é¼ å‚™ç”¨
TF.InputBegan:Connect(function(inp)
    if inp.UserInputType ~= Enum.UserInputType.MouseButton1 then return end
    local ax = inp.Position.X
    local ay = inp.Position.Y
    if inTitleBar(ax, ay) then
        dragging = true
        dragOff  = Vector2.new(ax, ay) - WIN.AbsolutePosition
    end
end)

UIS.InputChanged:Connect(function(inp)
    if not dragging then return end
    if inp.UserInputType == Enum.UserInputType.MouseMovement then
        local ax = inp.Position.X
        local ay = inp.Position.Y
        WIN.Position = UDim2.new(0, ax - dragOff.X, 0, ay - dragOff.Y)
    end
end)

UIS.InputEnded:Connect(function(inp)
    if inp.UserInputType == Enum.UserInputType.MouseButton1 then
        if mini then
            local ax = inp.Position.X
            local ay = inp.Position.Y
            local wp = WIN.AbsolutePosition
            local ws = WIN.AbsoluteSize
            if ax>=wp.X and ax<=wp.X+ws.X and ay>=wp.Y and ay<=wp.Y+ws.Y then
                mini=false
                BODY.Visible=true; SBF.Visible=true
                EF.Visible=true;   STL.Visible=true
                BCLR.Visible=true; CNTL.Visible=true
                TITLELBL.Visible=true; BYLBL.Visible=true
                MINILBL.Visible=false
                WIN.Size=UDim2.new(0,420,0,352); TF.Size=UDim2.new(1,0,0,28)
                TF_CORNER.CornerRadius = UDim.new(0,0)  -- â˜… å±•é–‹æ™‚ç§»é™¤åœ“è§’
                BCLOSE.Visible=true; BMIN.Visible=true; tc.Visible=true
            end
        end
        dragging = false
    end
end)

-- â”€â”€ æœå°‹åˆ— Y=32 H=24 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
local SBF=F({Size=UDim2.new(1,-8,0,22),Position=UDim2.new(0,4,0,32),
    BackgroundColor3=K.p2,BorderSizePixel=0},WIN)
rnd(5,SBF); stk(K.bdr,1,SBF)

L({Text="ðŸ”",Size=UDim2.new(0,15,1,0),Position=UDim2.new(0,3,0,0),
    BackgroundTransparency=1,TextColor3=K.dim,Font=Enum.Font.Gotham,TextSize=10},SBF)

local SRCH=TB({Text="",PlaceholderText="æœå°‹...",
    Size=UDim2.new(1,-66,1,0),Position=UDim2.new(0,18,0,0),
    BackgroundTransparency=1,TextColor3=K.txt,PlaceholderColor3=K.dim,
    Font=Enum.Font.Gotham,TextSize=10,ClearTextOnFocus=false,BorderSizePixel=0},SBF)

local BRE=B({Text="RE",Size=UDim2.new(0,24,0,14),Position=UDim2.new(1,-52,0,4),
    BackgroundColor3=Color3.fromRGB(15,40,64),TextColor3=K.RE,
    Font=Enum.Font.GothamBold,TextSize=8,BorderSizePixel=0},SBF)
rnd(3,BRE)

local BRF2=B({Text="RF",Size=UDim2.new(0,24,0,14),Position=UDim2.new(1,-24,0,4),
    BackgroundColor3=Color3.fromRGB(44,15,64),TextColor3=K.RF,
    Font=Enum.Font.GothamBold,TextSize=8,BorderSizePixel=0},SBF)
rnd(3,BRF2)

-- â”€â”€ ä¸»é«” Y=58 H=180 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
local BODY=F({Size=UDim2.new(1,-8,0,180),Position=UDim2.new(0,4,0,58),
    BackgroundTransparency=1,BorderSizePixel=0},WIN)

-- å·¦æ¸…å–® 170px
local LF=F({Size=UDim2.new(0,170,1,0),BackgroundColor3=K.pnl,BorderSizePixel=0},BODY)
rnd(5,LF); stk(K.bdr,1,LF)

local LSF=SF({Size=UDim2.new(1,-2,1,-2),Position=UDim2.new(0,1,0,1),
    BackgroundTransparency=1,BorderSizePixel=0,
    ScrollBarThickness=4,ScrollBarImageColor3=K.acc,
    CanvasSize=UDim2.new(0,0,0,0),AutomaticCanvasSize=Enum.AutomaticSize.Y},LF)
lst(1,LSF)

-- â˜… ç„¡äº‹ä»¶æç¤º
local EMPTYLBL=L({Text="å°šç„¡äº‹ä»¶\nç­‰å¾…æ•ç²ä¸­...",
    Size=UDim2.new(1,-10,1,-10),Position=UDim2.new(0,5,0,5),
    BackgroundTransparency=1,TextColor3=K.dim,
    Font=Enum.Font.Gotham,TextSize=9,
    TextXAlignment=Enum.TextXAlignment.Center,
    TextYAlignment=Enum.TextYAlignment.Center,
    Visible=true},LF)

-- å³è©³æƒ…
local RF2=F({Size=UDim2.new(1,-176,1,0),Position=UDim2.new(0,176,0,0),
    BackgroundColor3=K.pnl,BorderSizePixel=0},BODY)
rnd(5,RF2); stk(K.bdr,1,RF2)

local DSF=SF({Size=UDim2.new(1,-4,1,-54),Position=UDim2.new(0,2,0,2),
    BackgroundTransparency=1,BorderSizePixel=0,
    ScrollBarThickness=4,ScrollBarImageColor3=K.acc,
    CanvasSize=UDim2.new(0,0,0,0),AutomaticCanvasSize=Enum.AutomaticSize.Y},RF2)

local DTXT=L({Text="â† é¸äº‹ä»¶",Size=UDim2.new(1,-2,0,14),
    BackgroundTransparency=1,TextColor3=K.cod,Font=Enum.Font.Code,TextSize=8,
    TextXAlignment=Enum.TextXAlignment.Left,TextYAlignment=Enum.TextYAlignment.Top,
    TextWrapped=true,AutomaticSize=Enum.AutomaticSize.Y},DSF)

-- å³æ“ä½œå€
local ABF=F({Size=UDim2.new(1,-4,0,50),Position=UDim2.new(0,2,1,-52),
    BackgroundTransparency=1,BorderSizePixel=0},RF2)

local function aB(txt,col,x,y,w)
    local b=B({Text=txt,Size=UDim2.new(0,w or 80,0,20),
        Position=UDim2.new(0,x,0,y),BackgroundColor3=K.p2,
        TextColor3=col,Font=Enum.Font.GothamBold,TextSize=8,BorderSizePixel=0},ABF)
    rnd(4,b); return b
end

local ACPY=aB("ðŸ“‹ ä»£ç¢¼",K.acc, 0, 0, 76)
local APTH=aB("ðŸ”— è·¯å¾‘",K.dim,80, 0, 72)
local ARN1=aB("â–¶ åŸ·è¡Œ", K.grn, 0,24, 60)
local ALOP=aB("ðŸ” é‡è¤‡",K.yel,64,24, 68)

L({Text="éš”å¹¾ç§’",Size=UDim2.new(0,32,0,10),Position=UDim2.new(0,0,0,46),
    BackgroundTransparency=1,TextColor3=K.dim,Font=Enum.Font.Gotham,TextSize=7},ABF)
local IBOX=TB({Text="1",Size=UDim2.new(0,22,0,12),Position=UDim2.new(0,34,0,44),
    BackgroundColor3=K.p2,TextColor3=K.txt,Font=Enum.Font.GothamBold,TextSize=8,
    TextXAlignment=Enum.TextXAlignment.Center,BorderSizePixel=0,ClearTextOnFocus=false},ABF)
rnd(2,IBOX); stk(K.bdr,1,IBOX)

L({Text="é‡è¤‡å¹¾æ¬¡(0=âˆž)",Size=UDim2.new(0,70,0,10),Position=UDim2.new(0,60,0,46),
    BackgroundTransparency=1,TextColor3=K.dim,Font=Enum.Font.Gotham,TextSize=7},ABF)
local TBOX=TB({Text="0",Size=UDim2.new(0,22,0,12),Position=UDim2.new(0,132,0,44),
    BackgroundColor3=K.p2,TextColor3=K.txt,Font=Enum.Font.GothamBold,TextSize=8,
    TextXAlignment=Enum.TextXAlignment.Center,BorderSizePixel=0,ClearTextOnFocus=false},ABF)
rnd(2,TBOX); stk(K.bdr,1,TBOX)

-- â”€â”€ è‡ªè¨‚ä»£ç¢¼å€ Y=242 H=94 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
local EF=F({Size=UDim2.new(1,-8,0,94),Position=UDim2.new(0,4,0,242),
    BackgroundColor3=K.pnl,BorderSizePixel=0},WIN)
rnd(5,EF); stk(K.bdr,1,EF)

L({Text="è‡ªè¨‚åŸ·è¡Œ",Size=UDim2.new(1,0,0,14),Position=UDim2.new(0,5,0,1),
    BackgroundTransparency=1,TextColor3=K.dim,Font=Enum.Font.GothamBold,
    TextSize=9,TextXAlignment=Enum.TextXAlignment.Left},EF)

local CBOX=TB({Text="",PlaceholderText="è²¼å…¥ Lua ä»£ç¢¼â€¦",
    Size=UDim2.new(1,-6,0,50),Position=UDim2.new(0,3,0,16),
    BackgroundColor3=Color3.fromRGB(9,10,15),TextColor3=K.cod,
    PlaceholderColor3=K.dim,Font=Enum.Font.Code,TextSize=8,
    TextXAlignment=Enum.TextXAlignment.Left,TextYAlignment=Enum.TextYAlignment.Top,
    MultiLine=true,TextWrapped=true,BorderSizePixel=0,ClearTextOnFocus=false},EF)
rnd(4,CBOX); stk(K.bdr,1,CBOX)
N("UIPadding",{PaddingTop=UDim.new(0,2),PaddingLeft=UDim.new(0,3),
    PaddingRight=UDim.new(0,3),PaddingBottom=UDim.new(0,2)},CBOX)

local EBR=F({Size=UDim2.new(1,-6,0,18),Position=UDim2.new(0,3,0,69),
    BackgroundTransparency=1,BorderSizePixel=0},EF)

local function eB(txt,col,x,w)
    local b=B({Text=txt,Size=UDim2.new(0,w or 52,0,16),
        Position=UDim2.new(0,x,0,0),BackgroundColor3=K.p2,
        TextColor3=col,Font=Enum.Font.GothamBold,
        TextSize=8,BorderSizePixel=0},EBR)
    rnd(3,b); return b
end

local ERN=eB("â–¶ åŸ·è¡Œ",K.grn, 0, 52)
L({Text="éš”å¹¾ç§’",Size=UDim2.new(0,32,1,0),Position=UDim2.new(0,56,0,0),
    BackgroundTransparency=1,TextColor3=K.dim,Font=Enum.Font.Gotham,TextSize=7},EBR)
local EIB=TB({Text="1",Size=UDim2.new(0,20,0,14),Position=UDim2.new(0,89,0,1),
    BackgroundColor3=K.p2,TextColor3=K.txt,Font=Enum.Font.GothamBold,TextSize=8,
    TextXAlignment=Enum.TextXAlignment.Center,BorderSizePixel=0,ClearTextOnFocus=false},EBR)
rnd(2,EIB); stk(K.bdr,1,EIB)

L({Text="é‡è¤‡å¹¾æ¬¡(0=âˆž)",Size=UDim2.new(0,68,1,0),Position=UDim2.new(0,113,0,0),
    BackgroundTransparency=1,TextColor3=K.dim,Font=Enum.Font.Gotham,TextSize=7},EBR)
local ETB=TB({Text="0",Size=UDim2.new(0,20,0,14),Position=UDim2.new(0,183,0,1),
    BackgroundColor3=K.p2,TextColor3=K.txt,Font=Enum.Font.GothamBold,TextSize=8,
    TextXAlignment=Enum.TextXAlignment.Center,BorderSizePixel=0,ClearTextOnFocus=false},EBR)
rnd(2,ETB); stk(K.bdr,1,ETB)

local ELP=eB("ðŸ” é‡è¤‡",K.yel,207, 58)
local ESP=eB("â¬› å…¨åœ", K.red,269, 50)

-- ç‹€æ…‹åˆ— Y=340
local STL=L({Text="å°±ç·’",Size=UDim2.new(1,-8,0,10),
    Position=UDim2.new(0,4,0,340),
    BackgroundTransparency=1,TextColor3=K.dim,
    Font=Enum.Font.Gotham,TextSize=7,
    TextXAlignment=Enum.TextXAlignment.Left},WIN)

-- ç¸®å°ç‹€æ…‹ç”¨çš„å°æ–¹å¡Šæ¨™ç±¤
local MINILBL=L({Text="RSP",Size=UDim2.new(1,-6,1,-6),Position=UDim2.new(0,3,0,3),
    BackgroundTransparency=1,TextColor3=K.acc,Font=Enum.Font.GothamBold,
    TextSize=13,TextXAlignment=Enum.TextXAlignment.Center,
    TextYAlignment=Enum.TextYAlignment.Center,Visible=false,ZIndex=8},TF)

-- â”€â”€ ç‹€æ…‹å‡½å¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
local function st(msg,col)
    STL.Text=msg; STL.TextColor3=col or K.dim
    task.delay(4,function()
        if STL.Text==msg then STL.Text="å°±ç·’";STL.TextColor3=K.dim end
    end)
end

-- â”€â”€ å‰å‘å®£å‘Š â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
local showDetail, refreshList

-- â”€â”€ æ¸…å–®åˆ— â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
local function makeRow(e)
    local isRE=e.rtype=="RemoteEvent"
    local rc=isRE and K.RE or K.RF

    local row=B({Text="",Size=UDim2.new(1,-4,0,30),
        BackgroundColor3=selId==e.id and K.sel or K.p2,
        BorderSizePixel=0,AutoButtonColor=false,LayoutOrder=-e.id},LSF)
    rnd(4,row)
    if selId==e.id then stk(K.acc,1,row) end

    local bdg=L({Text=isRE and "RE" or "RF",
        Size=UDim2.new(0,18,0,11),Position=UDim2.new(0,3,0,4),
        BackgroundColor3=Color3.fromRGB(12,16,28),
        TextColor3=rc,Font=Enum.Font.GothamBold,TextSize=7,
        TextXAlignment=Enum.TextXAlignment.Center},row)
    rnd(3,bdg); stk(rc,1,bdg)

    L({Text=e.name,Size=UDim2.new(1,-26,0,14),Position=UDim2.new(0,24,0,2),
        BackgroundTransparency=1,TextColor3=K.txt,Font=Enum.Font.GothamBold,
        TextSize=10,TextXAlignment=Enum.TextXAlignment.Left,
        TextTruncate=Enum.TextTruncate.AtEnd},row)

    L({Text=e.ts,Size=UDim2.new(0,38,0,11),Position=UDim2.new(1,-40,0,2),
        BackgroundTransparency=1,TextColor3=K.dim,Font=Enum.Font.Gotham,
        TextSize=7,TextXAlignment=Enum.TextXAlignment.Right},row)

    local prev
    if #e.args>0 then
        local ok, result = pcall(function() return ser(e.args[1]):sub(1,22) end)
        if ok then
            prev = result..(#e.args>1 and "â€¦" or "")
        else
            prev = "(éŒ¯èª¤)"..(#e.args>1 and "â€¦" or "")
        end
    else
        prev = "(ç©º)"
    end
    L({Text=prev,Size=UDim2.new(1,-5,0,11),Position=UDim2.new(0,3,0,18),
        BackgroundTransparency=1,TextColor3=K.dim,Font=Enum.Font.Code,
        TextSize=7,TextXAlignment=Enum.TextXAlignment.Left,
        TextTruncate=Enum.TextTruncate.AtEnd},row)

    row.MouseButton1Click:Connect(function()
        -- â˜… åªæ›´æ–°é¸ä¸­ç‹€æ…‹ï¼Œä¸é‡å»ºæ•´å€‹åˆ—è¡¨
        local oldSelId = selId
        selId=e.id
        CBOX.Text=e.code
        showDetail(e)
        
        -- â˜… åªæ›´æ–°è¦–è¦ºæ•ˆæžœï¼šå–æ¶ˆèˆŠé¸ä¸­ï¼Œè¨­ç½®æ–°é¸ä¸­
        if oldSelId ~= selId then
            for _,c in ipairs(LSF:GetChildren()) do
                if c:IsA("TextButton") then
                    local isSelected = (c.LayoutOrder == -selId)
                    c.BackgroundColor3 = isSelected and K.sel or K.p2
                    -- æ›´æ–°é‚Šæ¡†
                    local stroke = c:FindFirstChildOfClass("UIStroke")
                    if stroke then stroke:Destroy() end
                    if isSelected then stk(K.acc,1,c) end
                end
            end
        end
    end)
    row.MouseEnter:Connect(function()
        if selId~=e.id then row.BackgroundColor3=K.hov end
    end)
    row.MouseLeave:Connect(function()
        if selId~=e.id then row.BackgroundColor3=K.p2 end
    end)
end

-- â”€â”€ refreshList â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
refreshList=function()
    for _,c in ipairs(LSF:GetChildren()) do
        if c:IsA("TextButton") then c:Destroy() end
    end
    local term=SRCH.Text:lower(); local shown=0
    for i=#captured,1,-1 do
        local e=captured[i]
        local mt=(e.rtype=="RemoteEvent" and fRE) or (e.rtype=="RemoteFunction" and fRF)
        local mn=term=="" or e.name:lower():find(term,1,true)
        if mt and mn then makeRow(e);shown=shown+1 end
    end
    CNTL.Text=#captured.." | "..shown
    -- â˜… æŽ§åˆ¶ç„¡äº‹ä»¶æç¤ºé¡¯ç¤º
    EMPTYLBL.Visible = (#captured == 0)
end

-- â”€â”€ showDetail â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
showDetail=function(e)
    if not e then DTXT.Text="â† é¸äº‹ä»¶";return end
    local ln={"å: "..e.name,"åž‹: "..e.rtype,"è·¯: "..e.path,"æ™‚: "..e.ts,"","åƒæ•¸("..#e.args.."å€‹):"}
    for i,a in ipairs(e.args) do
        table.insert(ln,("  [%d]%s=%s"):format(i,typeof(a),ser(a)))
    end
    table.insert(ln,"\n"..e.code)
    DTXT.Text=table.concat(ln,"\n")
end

-- â”€â”€ _G æ©‹æŽ¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
-- â˜… Hook åŸ·è¡Œç·’åªæ”¾å…¥ä½‡åˆ—ï¼Œä¸ç¢°ä»»ä½• GUI Instance
_G._RSP5=function(e)
    pendingQueue[#pendingQueue+1] = e
end

-- â˜… Heartbeat åœ¨ä¸»åŸ·è¡Œç·’è™•ç†ä½‡åˆ—ï¼Œå¯ä»¥å®‰å…¨å‰µå»º GUI
RS.Heartbeat:Connect(function()
    if #pendingQueue == 0 then return end
    local batch = pendingQueue
    pendingQueue = {}
    for _, e in ipairs(batch) do
        local mt=(e.rtype=="RemoteEvent" and fRE) or (e.rtype=="RemoteFunction" and fRF)
        if mt then
            local ok, err = pcall(makeRow, e)
            if ok then
                EMPTYLBL.Visible=false
            else
                warn("[RSP] makeRow error:", err)
            end
        end
        -- æ›´æ–°è¨ˆæ•¸
        local term=SRCH.Text:lower()
        local shown=0
        for i=#captured,1,-1 do
            local ev=captured[i]
            local match_type=(ev.rtype=="RemoteEvent" and fRE) or (ev.rtype=="RemoteFunction" and fRF)
            local match_name=term=="" or ev.name:lower():find(term,1,true)
            if match_type and match_name then shown=shown+1 end
        end
        CNTL.Text=#captured.." | "..shown
    end
end)

-- â”€â”€ åŸ·è¡Œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
local function runOnce(code)
    local ok,err=exec(code)
    if ok then st("âœ… åŸ·è¡ŒæˆåŠŸ",K.grn)
    else      st("âŒ "..tostring(err):sub(1,50),K.red) end
end

local function startLoop(code,iv,tm)
    loopN=loopN+1;local id=loopN;loops[id]=true
    st("ðŸ”["..id.."] "..(tm==0 and "âˆž" or tm).."æ¬¡ "..iv.."s",K.yel)
    task.spawn(function()
        local n=0
        while loops[id] do
            n=n+1; exec(code)
            if tm>0 and n>=tm then break end
            task.wait(math.max(0.05,iv))
        end
        loops[id]=nil
        st("âœ…["..id.."] çµæŸ "..n.."æ¬¡",K.grn)
    end)
end

local function stopAll()
    local n=0
    for id in pairs(loops) do loops[id]=nil;n=n+1 end
    st("â¬› åœæ­¢"..n.."å€‹",K.red)
end

local function getSel()
    if not selId then return nil end
    for _,e in ipairs(captured) do if e.id==selId then return e end end
end

-- â”€â”€ æŒ‰éˆ•äº‹ä»¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
BCLOSE.MouseButton1Click:Connect(function() stopAll();SG:Destroy() end)

BMIN.MouseButton1Click:Connect(function()
    mini=not mini
    BODY.Visible    = not mini
    SBF.Visible     = not mini
    EF.Visible      = not mini
    STL.Visible     = not mini
    BCLR.Visible    = not mini
    CNTL.Visible    = not mini
    TITLELBL.Visible= not mini
    BYLBL.Visible   = not mini
    MINILBL.Visible = mini
    if mini then
        WIN.Size   = UDim2.new(0,50,0,50)
        TF.Size    = UDim2.new(1,0,1,0)
        TF_CORNER.CornerRadius = UDim.new(0,8)  -- â˜… ç¸®å°æ™‚åŠ åœ“è§’
        BCLOSE.Visible = false
        BMIN.Visible   = false
        tc.Visible     = false
    else
        WIN.Size   = UDim2.new(0,420,0,352)
        TF.Size    = UDim2.new(1,0,0,28)
        TF_CORNER.CornerRadius = UDim.new(0,0)  -- â˜… å±•é–‹æ™‚ç§»é™¤åœ“è§’
        BCLOSE.Visible = true
        BMIN.Visible   = true
        tc.Visible     = true
    end
end)

-- â˜… é»žæ“Šç¸®å°å¾Œçš„å°æ–¹å¡Šå±•é–‹ï¼ˆè§¸æŽ§ç‰ˆï¼Œä¿®æ­£èª¤è§¸ï¼‰
local miniTouchStart = nil
UIS.TouchStarted:Connect(function(touch, _)
    if not mini then return end
    local ax = touch.Position.X
    local ay = touch.Position.Y
    local wp = WIN.AbsolutePosition
    local ws = WIN.AbsoluteSize
    -- åªè¨˜éŒ„é»žåœ¨å°æ–¹å¡Šä¸Šçš„è§¸æŽ§
    if ax >= wp.X and ax <= wp.X + ws.X and ay >= wp.Y and ay <= wp.Y + ws.Y then
        miniTouchStart = Vector2.new(ax, ay)
    end
end)

UIS.TouchEnded:Connect(function(touch, _)
    if not mini then miniTouchStart=nil; return end
    if miniTouchStart then
        local dx = touch.Position.X - miniTouchStart.X
        local dy = touch.Position.Y - miniTouchStart.Y
        local dist = math.sqrt(dx*dx + dy*dy)
        local endX = touch.Position.X
        local endY = touch.Position.Y
        miniTouchStart = nil
        
        -- ç¢ºèªçµæŸæ™‚æ‰‹æŒ‡é‚„åœ¨å°æ–¹å¡Šä¸Š
        local wp = WIN.AbsolutePosition
        local ws = WIN.AbsoluteSize
        if dist < 12 and endX >= wp.X and endX <= wp.X + ws.X 
           and endY >= wp.Y and endY <= wp.Y + ws.Y then
            mini = false
            BODY.Visible=true; SBF.Visible=true
            EF.Visible=true;   STL.Visible=true
            BCLR.Visible=true; CNTL.Visible=true
            TITLELBL.Visible=true; BYLBL.Visible=true
            MINILBL.Visible=false
            WIN.Size   = UDim2.new(0,420,0,352)
            TF.Size    = UDim2.new(1,0,0,28)
            TF_CORNER.CornerRadius = UDim.new(0,0)  -- â˜… å±•é–‹æ™‚ç§»é™¤åœ“è§’
            BCLOSE.Visible=true; BMIN.Visible=true; tc.Visible=true
        end
    end
end)

BCLR.MouseButton1Click:Connect(function()
    captured={};selId=nil
    for _,c in ipairs(LSF:GetChildren()) do
        if c:IsA("TextButton") then c:Destroy() end
    end
    showDetail(nil);CNTL.Text="0"
    EMPTYLBL.Visible=true  -- â˜… æ¸…é™¤å¾Œé¡¯ç¤ºæç¤º
    st("ðŸ—‘ æ¸…é™¤",K.dim)
end)

SRCH:GetPropertyChangedSignal("Text"):Connect(refreshList)

BRE.MouseButton1Click:Connect(function()
    fRE=not fRE
    BRE.BackgroundColor3=fRE and Color3.fromRGB(15,40,64) or K.p2
    BRE.TextColor3=fRE and K.RE or K.dim
    refreshList()  -- â˜… é‡æ–°æ•´ç†åˆ—è¡¨ï¼Œé¡¯ç¤º/éš±è— RE äº‹ä»¶
end)
BRF2.MouseButton1Click:Connect(function()
    fRF=not fRF
    BRF2.BackgroundColor3=fRF and Color3.fromRGB(44,15,64) or K.p2
    BRF2.TextColor3=fRF and K.RF or K.dim
    refreshList()  -- â˜… é‡æ–°æ•´ç†åˆ—è¡¨ï¼Œé¡¯ç¤º/éš±è— RF äº‹ä»¶
end)

ACPY.MouseButton1Click:Connect(function()
    local e=getSel();if not e then st("âš  å…ˆé¸äº‹ä»¶",K.yel);return end
    clip(e.code);st("ðŸ“‹ ä»£ç¢¼å·²è¤‡è£½",K.grn)
end)
APTH.MouseButton1Click:Connect(function()
    local e=getSel();if not e then st("âš  å…ˆé¸äº‹ä»¶",K.yel);return end
    clip(e.path);st("ðŸ”— è·¯å¾‘å·²è¤‡è£½",K.grn)
end)
ARN1.MouseButton1Click:Connect(function()
    local e=getSel();if not e then st("âš  å…ˆé¸äº‹ä»¶",K.yel);return end
    runOnce(e.code)
end)
ALOP.MouseButton1Click:Connect(function()
    local e=getSel();if not e then st("âš  å…ˆé¸äº‹ä»¶",K.yel);return end
    startLoop(e.code,
        math.max(0.05,tonumber(IBOX.Text) or 1),
        math.max(0,tonumber(TBOX.Text) or 0))
end)

ERN.MouseButton1Click:Connect(function()
    local c=CBOX.Text;if c=="" then st("âš  ç©ºçš„",K.yel);return end
    runOnce(c)
end)
ELP.MouseButton1Click:Connect(function()
    local c=CBOX.Text;if c=="" then st("âš  ç©ºçš„",K.yel);return end
    startLoop(c,
        math.max(0.05,tonumber(EIB.Text) or 1),
        math.max(0,tonumber(ETB.Text) or 0))
end)
ESP.MouseButton1Click:Connect(function() stopAll() end)

-- â”€â”€ å•Ÿå‹• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
refreshList()
st("âœ… å•Ÿå‹•ï¼Œç›£è½ä¸­â€¦",K.grn)
print("[RSP v5] Delta ready - Fixed version")
